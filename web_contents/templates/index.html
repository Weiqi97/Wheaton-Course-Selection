<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Course Selection</title>
    <!-- Project javascript -->
    <script src="../static/js/script_base.js"></script>
    <!-- Project CSS -->
    <link rel="stylesheet" href="../static/css/style_base.css">
    <!-- Jquery JS -->
    <script src="../static/node_modules/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../static/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../static/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/node_modules/bootstrap/dist/css/bootstrap-theme.min.css">
    <!-- CSS and JS for sweet alert package. -->
    <script src="../static/node_modules/sweetalert2/dist/sweetalert2.js"></script>
    <link rel="stylesheet" href="../static/node_modules/sweetalert2/dist/sweetalert2.css">
    <!-- Bootstrap Select -->
    <script src="../static/node_modules/bootstrap-select/dist/js/bootstrap-select.js"></script>
    <link rel="stylesheet" href="../static/node_modules/bootstrap-select/dist/css/bootstrap-select.css">
    <!-- Data Table -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Questrial|Roboto+Condensed">

    <!-- Function call for data table -->
    <script>

        $(document).ready(function() {
            var window_height = window.innerHeight-350;
            console.log(window_height);
            $('#result_table').DataTable( {
                "scrollY": window_height,
                "scrollCollapse": true,
                "paging":         false
            });
        });

        $(function(){
           $(window).on('resize', resize_result_table);
        });
        function resize_result_table(){

            var window_height = window.innerHeight-350;
            console.log("the new height"+window_height);
            $('#result_table').DataTable( {
                "destroy": true,
                "scrollY": window_height,
                "scrollCollapse": true,
                "paging":         false
            });
        }


    </script>
    <style>
        .home{
            display:none;
        }

    </style>
</head>


<body>
    <div class="container-fluid header">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 college_header">
                <b>Wheaton College </b>
                <sub>- The right tool to help you pick classes</sub>
              </div>
        </div>
    </div>
    <div class="container-fluid course-picker">
        <div class="row">
            <form name="Selections" method="post">
                <select class="selectpicker col-lg-2" id="semester" name="semester" title="Semesters">
                    <option value="" selected>Semesters</option>
                    {% for name in fetched_semesters.index %}
                        <option value= "{{name}}">{{name}}</option>"
                    {% endfor %}
                </select>

                <select class="selectpicker col-lg-2" data-live-search="true" id="subjects"
                        name="subjects" title="Subject(s)" multiple="multiple">
                    {% for name, value in fetched_subjects.iteritems() %}
                        <option value= "{{value}}">{{name}}</option>"
                    {% endfor %}
                </select>

                <label for="foundation"></label>
                <select class="selectpicker col-lg-2" id="foundation" name="foundation">
                    {% for name, value in fetched_foundations.iteritems() %}
                        <option value= "{{value}}">{{name}}</option>"
                    {% endfor %}
                </select>

                <label for="division"></label>
                <select class="selectpicker col-lg-2" id="division" name="division">
                    {% for name, value in fetched_divisions.iteritems() %}
                        <option value= "{{value}}">{{name}}</option>"
                    {% endfor %}
                </select>

                <label for="area"></label>
                <select class="selectpicker col-lg-2" id="area" name="area">
                    {% for name, value in fetched_areas.iteritems() %}
                        <option value= "{{value}}">{{name}}</option>"
                    {% endfor %}
                </select>

                <button type="submit" id="submit" onclick="return checkField()">
                    Search &nbsp
                </button><i class="glyphicon glyphicon-search"></i>
            </form>
        </div>
    </div>
    <br>
    <div class="container-fluid">
        <div class="col-lg-6 col-md-6">STH</div>
        <div class="col-lg-6 col-md-6 result_table">
            {% if data_generated %}
                <table class="table table-striped" id="result_table" style="width: 50%;">
                    <thead>
                        <tr>
                            <th class="courseNumber">Course Number</th>
                            <th>Title</th>
                            <th>Time</th>
                            <th>Instructor</th>
                            <th>CRN</th>
                            <th id="add_button">To calendar</th>
                        </tr>
                    </thead>
                    <tbody>
                    {%  for _, row in selected_data.iterrows() %}
                        <tr>
                            <td>
                                <a target="_blank" href={{ row["number"].link }}>
                                    {{ row["number"].num }}
                                </a>
                            </td>

                            <td>{{ row["title"] }}</td>
                            <td>
                                {% for time in row["time"] %}
                                    {{ time }}<br>
                                {% endfor %}
                            </td>
                            <td>
                                {% for instructor in row["instructor"] %}
                                    <a target="_blank" href={{ instructor.link }}>
                                        {{ instructor.name }}
                                    </a>
                                    <br>
                                {% endfor %}
                            </td>
                            <td>{{ row["CRN"] }}</td>
                            <td id="add_button"><button class="add_class glyphicon glyphicon-plus"</button></td>
                        </tr>

                    {% endfor %}

                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>
    <br>
<div class="container-fluid header">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 college_header">
                <b>Wheaton College </b>
                <sub>- The right tool to help you pick classes</sub>
              </div>
        </div>
    </div>
</body>

<script>
    /*This function gets data from the row that has been clicked*/
    $(".add_class" ).click(function() {
        var $row = $(this).closest("tr");      // Finds the closest row <tr>
        var $tds = $row.find("td");             // Finds all children <td> elements
        $.each($tds, function() {               // Visits every single <td> element
           // console.log($(this).text());        // Prints out the text within the <td>
        });
        //var name = ($tds[2].innerHTML).replace(/\s+/g, " ");

        var name = $tds[2].innerHTML;
        name = $.trim(name);
        name = name.replace(/\s+/g, "");
        name = name.split("<br>"); //deletes the <br>
        //console.log("sdsd:" + name);
       // console.log(name);
        name = Array.from(name);
        console.log(name);
        var days=[];
        var time =[];
        var i = 0;
        var k =0;
        var j =0;

        name = Array.from(name[0]);
        $(name).each(function(){
            if (name[i].charCodeAt(0) > 64 & name[i]!=='P' & name[i]!=='A' & name[i]!=='r'){
                days[j] = name[i];
                j++;
                i++;
            }
            else if(name[i].charCodeAt(0) < 58){
                time[k] = name[i];
                k++;
                i++;
            }
            else{
                i++;
            }
        });
        console.log(name);
        days = days.slice(0,-2);
        console.log("days: " + days);
        console.log("time:" +time);
    });

</script>
</html>